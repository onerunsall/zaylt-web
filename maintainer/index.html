<!DOCTYPE html>
<html>
<head lang="en">
    <script>
        var rootDis="../"
    </script>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="../resource/favicon.ico" type="image/x-icon" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta http-equiv="Cache-Control" content="max-age=7200"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>忠安医联体运维平台</title>
    <script src="libs/public.js"></script>
    <link rel="stylesheet" href="libs/public.css"/>
    <script src="index/index.js"></script>
    <link rel="stylesheet" href="index/index.css"/>
    <script src="../libs/giveup.js"></script>
    <script src="../libs/jquery.min.js"></script>
    <script src="../libs/zTree_v3/js/jquery.ztree.all.js"></script>
    <link rel="stylesheet" href="../libs/zTree_v3/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <script src="../libs/navim.js"></script>
    <script src="../libs/jquery.cookie.js"></script>
    <script src="../libs/jquery.extend.giveup.js"></script>
    <script src="../libs/layer/layer.js"></script>

</head>
<style>
    .ztree li {
        margin: 3px;
    }

    .ztree * {
        font-size: 14px;

    }

    button, select {
        cursor: pointer;

    }


</style>
<body style="margin:0">

<div style="height:70px;border-bottom: 1px solid darkgray;">
    <div style="line-height: 60px;float:left;height:100%;font-weight: 700;font-size: 24px;margin-left:20px;">忠安医联体运维平台
    </div>
</div>
<div>
    <div style="float:left;position: fixed;left: 0;bottom:  0;top:71px;display: inline-block;width:250px;border-right: 1px solid darkgray;text-align: center;overflow: auto;">
        <div style="width:100%;border-bottom:1px solid #e4e5e7;text-align:center;padding:10px 0;">
            <img src="./index/resource/head.png" style="width:60px;">
            <div id="username" style="color: rgb(119, 119, 119);"></div>
        </div>
        <ul id="menu" class="ztree" style="padding:0;margin:0"></ul>
    </div>
    <div style="float:left;position: fixed;left: 251px;;bottom: 0;top:71px;right:0;display: inline-block;">
        <iframe style="width:100%;height:100%" frameborder="no" src="./hospital.html?currentPath=医院管理"></iframe>
    </div>
</div>
</body>

<script>

    var token = $.cookie('token'),loginStatus, username, zNodes;

    $.ajaxSetup({
        layerIndex: -1,
        beforeSend: function () {
            this.layerIndex = layer.load(0, {shade: [0.5, '#393D49']});
        },
        complete: function () {
            layer.close(this.layerIndex);
        }
    });

    if (token) {
        $.ajax({
            url: rootDis+'maintainer/loginRefresh',
            data: {token: token},
            type: 'post',
            async: false,
            success: function (res) {
                if (res.code == 0) {
                    $.cookie('token', res.data.token, {expires: 30, path: '/'});
                    $.cookie('loginStatus_'+token, JSON.stringify(res.data), {expires: 30, path: '/'});

                    username = res.data.username
                } else {
                    $.removeCookie('token', {path: '/'});
                    $.removeCookie('loginStatus_'+token, {path: '/'});
                    resCodeProcess(res.code,res.codeMsg)
                }
            }
        })
    } else
        location.href = './login.html';


    $('#username').text(username)


    zNodes = []

    zNodes.push({
        name: '医院端管理', children: [
            {name: '用户管理', uurl: './hospitaler.html?currentPath=医院端用户管理'},
            {name: '医院管理', uurl: './hospital.html?currentPath=医院管理'},
            {name: '医院主轮播', uurl: './hospitalMaincarousel.html?currentPath=医院主轮播'},
            // {name: '权限管理', uurl: './userapis.html?currentPath=医院端权限管理'}
        ]
    })
    zNodes.push({
        name: '门诊端管理', children: [
            {name: '用户管理', uurl: './clinicer.html?currentPath=门诊端用户管理'},
            {name: '门诊管理', uurl: './clinic.html?currentPath=门诊管理'},
            // {name: '权限管理', uurl: './userapis.html?currentPath=门诊端权限管理'}
        ]
    })

    zNodes.push({name: '病人管理', uurl: './patient.html?currentPath=病人管理'})
    zNodes.push({name: '文章管理', uurl: './article.html?currentPath=文章管理'})
    zNodes.push({name: '科室管理', uurl: './office.html?currentPath=科室管理'})
    zNodes.push({name: '专家管理', uurl: './doctor.html?currentPath=专家管理'})
    zNodes.push({name: '集采主轮播', uurl: './procurementMaincarousel.html?currentPath=集采主轮播'})


    // zNodes.push({
    //     name: '运维端管理', children: [
    //         {name: '用户管理', uurl: './maintainuser.html?currentPath=运维端用户管理'},
    //         {name: '权限管理', uurl: './maintainuserapis.html?currentPath=运维端权限管理'}
    //     ]
    // })
    // zNodes.push({
    //     name: '配置页面', children: [
    //         {name: '客户端用户协议', uurl: './setpage/setuserprotocol.html?currentPath=客户端用户协议'}
    //     ]
    // })
    // zNodes.push({name: '系统配置', uurl: './sysparam.html?currentPath=系统配置'})
    // zNodes.push({name: '文件管理', uurl: './file.html?currentPath=文件管理'})
    // zNodes.push({name: '个人中心', uurl: './mycenter.html?currentPath=个人中心'})
    zNodes.push({name: '退出登录', uurl: ''})
    // zTree 的参数配置，深入使用请参考 API 文档（setting 配置详解）
    var setting = {
        view: {
            dblClickExpand: false
        },
        callback: {
            onClick: function (e, treeId, treeNode) {
                if (treeNode.name == '退出登录') {
                    logout();
                    return
                }
                zTreeObj.expandNode(treeNode);
                navim.clear()
                $('iframe').attr('src', treeNode.uurl)
                //$(treeNode).parent().parent().css('background-color','#e8e8e8')
            }
        }
    };
    // zTree 的数据属性，深入使用请参考 API 文档（zTreeNode 节点数据详解）
    var zTreeObj = $.fn.zTree.init($("#menu"), setting, zNodes);


    function logout() {
        $.removeCookie('token', {path: '/'});
        $.removeCookie('loginStatus_'+token, {path: '/'});
        $.ajax({
            url:rootDis+'maintainer/logout',
            data: {token: token},
            async: true
        })
        location.href = './login.html';
    }
</script>
</html>